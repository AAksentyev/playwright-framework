<!DOCTYPE html>
<html>
<head>
<title>Heatmap</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/heatmap.js/2.0.2/heatmap.min.js"></script>
<style>
    html, body {
        margin: 0;
        padding: 0;
    }
    .marker {
        position: absolute;
        width: 12px;
        height: 12px;
        background: rgba(255, 0, 0, 0.8);
        border-radius: 50%;
        cursor: pointer;
        transform: translate(-50%, -50%);
    }

    .tooltip {
        position: absolute;
        background: #333;
        color: #fff;
        padding: 6px 10px;
        border-radius: 4px;
        font-size: 12px;
        pointer-events: none;
        white-space: nowrap;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 9999;
    }

</style>
</head>
<body>
<div id="container" style="position:relative; width:100%; height:100%;">
    <img id="screenshot" src="./screenshot.png" style="width:auto; height:auto; position:absolute;">
    <div id="heatmap" style="position:absolute; top:0; left:0; width:100%; height:100%;"></div>
</div>

<script>
    const img = document.getElementById("screenshot");

    img.onload = () => {
        const heatmapDiv = document.getElementById("heatmap");
        heatmapDiv.style.width = img.naturalWidth + "px";
        heatmapDiv.style.height = img.naturalHeight + "px";

        const points = {{points}}

        const heatmapInstance = h337.create({
            container: heatmapDiv,
            radius: {{radius}},
            maxOpacity: {{maxOpacity}},
            minOpacity: {{minOpacity}},
            blur: {{blur}}
        });

        heatmapInstance.setData({
            max: {{maxPoints}},
            data: {{points}}
        });

         // Create tooltip element
        const tooltip = document.createElement("div");
        tooltip.classList.add("tooltip");
        document.body.appendChild(tooltip);

        // Add markers for each point
        points.forEach(p => {
            const marker = document.createElement("div");
            marker.classList.add("marker");

            marker.style.left = p.x + "px";
            marker.style.top = p.y + "px";

            marker.addEventListener("mouseenter", (e) => {
                const counts = p.counts;
                
                // Build a string for each type of interaction
                // to dynamically only add interactions we actually performed
                const interactions = Object.entries(counts)
                    .map(([type, count]) => `${type}s: ${count}`)
                    .join('<br>');

                tooltip.innerHTML = `
                    <strong>Interactions:</strong><br>
                    ${interactions}<br>
                    Total: ${p.value}
                `;
                tooltip.style.opacity = '1';
            });

            marker.addEventListener("mousemove", (e) => {
                tooltip.style.left = (e.pageX + 10) + "px";
                tooltip.style.top = (e.pageY + 10) + "px";
            });

            marker.addEventListener("mouseleave", () => {
                tooltip.style.opacity = 0;
            });

            heatmapDiv.appendChild(marker);
        });
    };
</script>
</body>
</html>